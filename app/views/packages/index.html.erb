
<h1>1/ Choisis ton panier</h1>


<div class="cards-index">
    <div class="row" >

        <div class="col-md-6" >
          <% @packages.each do |package| %>

             <!-- Modal -->
              <div class="modal fade" id="exampleModal-<%= package.id%>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <%= cl_image_tag(package.photo, width: '95%') %>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                      </button>
                    </div>

                    <div class="modal-body text-center">
                      <h3 class="modal-title" id="exampleModalLabel"> <%= package.name %></h3>
                      <p class="modal-title" id="exampleModalLabel"> <%= package.description %></p>
                      <h3 class="modal-title" id="exampleModalLabel"> <%= package.price %>€</h3>
                    </div>
                    <div class="modal-footer" id="quantity-form-button">
                    <%= render 'cart_items/form', package: package, cart_item: @cart_item %>
                    <!-- <button type="but ton" class="btn btn-primary">Add</button> -->
                    </div>
                  </div>
                </div>
              </div>
       <!-- Modal end -->

            <div class="card-product">
              <%= cl_image_tag package.photo, crop: :fit %>

                <div class="card-product-infos">
                  <h2><%= package.name %></h2>
                  <p><%= package.description %></p>
                </div>
                <!-- Button trigger modal -->
                <div class="card-package-button-details ">
                  <button type="button" class="btn btn-primary btn-sm" id="card-package-button-details" data-toggle="modal" data-target="#exampleModal-<%= package.id%>">Details</button>
                  <div class="card-product-price">
                    <h2 class="text-center"><%= package.price %>€</h2>
                  </div>
                  </div>
                </div>
          <% end %>
        </div>

      <div class="col-md-4" id="cart-table">
        <table class="table table text-center">
            <thead>
              <tr>
              <h4 class="text-center">Votre panier en cours:</h4>
              <br>
              <th scope="col"></th>
              <th scope="col">Nom du panier</th>
              <th scope="col">Quantité</th>
              <th scope="col">Prix unitaire</th>
              <th scope="col">Total</th>
              </tr>
            </thead>
              <% total_price = 0 %>
              <% current_user.cart.cart_items.each do |cart_item| %>
            <tbody>
              <tr>
              <td></td>
              <td> <%= cart_item.package.name %></td>
              <td><%= cart_item.quantity  %></td>
              <td><%= cart_item.package.price %> €</td>
               <% price_per_panier = cart_item.package.price * cart_item.quantity %>
              <td><%= price_per_panier %> €</td>
              <td><%= link_to cart_item_path(cart_item), method: :delete, data: { confirm: "Confirmez-vous cette suppression ?" } do %>
                  <i class="fa fa-trash destroy_package_cart_item"></i></td>
                  <% end %>
              </tr>
              <% total_price += price_per_panier %>
              <% end %>
           </tbody>
          </table>
          <h5 class="text-right">Total: <%= total_price %> €</h5>
          <div class="validation-cart">
            <%= link_to "Valider", orders_path, method: :post, class: "btn btn-primary btn-sm" %>
          </div>
      </div>

    </div>
  </div>
