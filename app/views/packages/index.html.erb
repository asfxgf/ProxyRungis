<div id="banner-index-packages" style="background-image: linear-gradient(rgba(0,0,0,0.5),rgba(0,0,0,0.5)), url('<%= cl_image_path'http://res.cloudinary.com/dhf3phkaa/image/upload/v1567519578/yoqd8ks471nbiy1etl3b.jpg', height: 600, width: 1200, crop: :fill %>')">
    <h1 class="text-center" id="title-index-packages">Nos paniers de fruits et légumes de saison</h1>
  </div>

    <div class="container" id="main-container-index-packages">
      <div class="container" id="container-index-packages">

        <div id="buttons-cart">
          <% unless current_user.cart.cart_items.empty? %>
            <div id="badge-cart">
              <button type="button" data-toggle="modal" data-target="#exampleModalCenter" id="button-cart"><span><i class="fa fa-shopping-basket" aria-hidden="true"></i>
              <p class="badge" id="cart-number-items"><%=current_user.cart.cart_items.count %></p></span></button>
            </div>
          <% end %>
        </div>

        <!-- Modal de Cart -->
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Votre commande en cours:</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>

              <div class="modal-body" id="modal-body-shopping-basket">
                <table class="table table text-center" id="table-modal-shopping-basket">
                  <thead>
                      <th scope="col"></th>
                      <th scope="col">Nom du panier</th>
                      <th scope="col">Quantité</th>
                      <th scope="col">Prix unitaire</th>
                      <th scope="col">Total</th>
                  </thead>

                  <% total_price = 0 %>
                  <% current_user.cart.cart_items.each do |cart_item| %>
                    <tbody>
                      <tr data-cart-item-id="<%= cart_item.id %>">
                        <td></td>
                       <!--  <td> <%= cl_image_tag cart_item.package.photo %></td> -->
                        <td><%= cart_item.package.name %></td>
                        <td><%= cart_item.quantity  %></td>
                        <td><%= cart_item.package.price %> €</td>
                         <% price_per_panier = cart_item.package.price * cart_item.quantity %>
                        <td><%= price_per_panier %> €</td>
                        <td><%= link_to cart_item_path(cart_item), method: :delete, remote: true do %>
                              <i class="fa fa-trash destroy_package_cart_item"></i></td>
                            <% end %>
                      </tr>
                      <% total_price += price_per_panier %>
                    </tbody>
                  <% end %>
                </table>
              </div>

              <div class="modal-footer" id="button-validation-cart-item">
                <%= link_to "Valider", orders_path(cart: current_user.cart), method: :post, class: "btn btn-primary btn-sm" %>
              </div>
            </div>
          </div>
        </div>
        <!-- End Modal de Cart -->

        <!-- Search form -->
        <div id="search-in-packages">
          <form action="/packages" method="get" id="packages-choices">
              <select name="category" class="custom-select my-1 mr-sm-2">
                <option value="" disabled selected>Sélectionner</option>
                <option value="Fruits" <%= 'selected' if params[:category] == "Fruits" %>>Fruits</option>
                <option value="Legumes" <%= 'selected' if params[:category] == "Legumes" %>>Légumes</option>
                <option value="Fruits & Legumes" <%= 'selected' if params[:category] == "Fruits & Legumes" %>>Fruits & légumes</option>
              </select>
              <input type="checkbox" name="bio" value=true id="ckeck-box-bio" <%= "checked" if params[:bio] == "true" %>>
              <label id="label-bio">Bio</label>
             <button type="submit" class="btn btn-primary my-1 bt-sm" id="button-validation-selection">Valider</button>
          </form>
        </div>


        <!-- Cards de packages form -->
        <div class="cards-index">
          <% @packages.each do |package| %>
            <div class="card-product" id="card-product-parent">
              <%= cl_image_tag package.photo, crop: :fit %>
              <div class="card-product-infos" id="card-product-infos">
                <div id="card-product-package-name"><h2><%= package.name %></h2></div>

                <div id="card-product-price-category-bio">
                  <% if params[:bio] == "true" %>
                    <div class="product-tag bg-green mr-1">Bio</div>
                  <% end %>
                  <% if package.category == "Fruits & legumes" %>
                    <div class="product-tag bg-orange">Fruits & légumes</div>
                  <% end %>
                  <% if package.category == "Fruits" %>
                    <div class="product-tag bg-pink">Fruits</div>
                  <% end %>
                  <% if package.category == "Legumes" %>
                    <div class="product-tag bg-blue">Légumes</div>
                  <% end %>
                </div>

                <div id="card-product-price"><h2><%= money_without_cents(package.price) %> €</h2></div>

              </div>

              <div class="card-product-cover">

                <div class="card-product-cover-infos">
                  <div class="card-product-cover-infos-description">
                    <div class="card-product-cover-infos-description-title">
                      <h5>Ce panier contient:</h5>
                    </div>
                    <div class="card-product-cover-infos-description-composition">
                      <% products = package.description.split(",") %>
                      <% products.each do |product|%>
                        <p><i class="fas fa-check" id="shopping-basket-icon-cover"></i> <%= product %></p>
                      <% end %>
                    </div>
                  </div>

                  <div class="card-product-cover-infos-price-button">
                    <h3><%= money_without_cents(package.price) %><span>€</span></h3>

                    <i class="fas fa-cart-plus" data-toggle="modal" data-target="#exampleModal-<%= package.id%>"></i>

                  </div>
                </div>

              </div>
            </div>

            <div class="modal fade" id="exampleModal-<%= package.id%>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">

                  <div class="modal-body text-center">
                    <h3 class="modal-title" id="modal-card-package"> <%= package.name %></h3>

                    <div id="modal-package-description-price">
                      <div>
                        <h3 class="modal-title" id="modal-package-price"> <%= money_without_cents(package.price) %>€</h3>
                      </div>
                    </div>
                  </div>


                  <div class="modal-footer" id="quantity-form-button"></button>
                  <%= render 'cart_items/form', package: package, cart_item: @cart_item %>
                  <!-- <button type="but ton" class="btn btn-primary">Add</button> -->
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>



      </div>
    </div>
